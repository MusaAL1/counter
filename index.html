<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" href="./style.css">
    <link rel=" icon" href="./assets/imags/beads.png" type="image/png">
    <link rel="apple-touch-icon" href="./assets/imags/beads.png">
    <title>مِسبحةْ</title>
</head>

<body id="body">
    <div id="intro">
        <div id="invalid-1" class="invalid">
            <input type="text" id="intro-input-1" pattern="[A-Za-z\u0600-\u06FF]{1,1000}"
                placeholder="أدخل عنوان الهدف!" autofocus />
        </div>
        <div id="invalid-2" class="invalid">
            <input type="text" id="intro-input-2" maxlength="5" pattern="[0-9]{1,5}" placeholder="أدخل عدد التكرار!" />
        </div>
        <button type="submit" id="click-start-intro">أبدأ</button>
        <div id="background-intro"></div>
    </div>

    <div class="container" id="container">
        <input type="text" id="adadprog" value="البداية!" disabled>
        <input type="text" id="adadgoal" value="الهدف!" disabled>
        <div class="read-wrapper" id="read-wrapper" aria-hidden="true">
            <div id="read" class="read-text" contenteditable="true"></div>
        </div>
        <div class="read-text-in-out" id="read-text-in-out"></div>
        <div id="adadgoaldone">✅</div>
    </div>
    <div id="reset" tabindex="0"><img src="./assets/imags/agin.png" alt="Reset"></div>
    <div id="background-2" class="background-click" tabindex="0"></div>
    <script>
        let intro = document.getElementById('intro');
        let background_intro = document.getElementById('background-intro');
        let intro_input_1 = document.getElementById('intro-input-1');
        let intro_input_2 = document.getElementById('intro-input-2');
        let click_start_intro = document.getElementById('click-start-intro');

        var input1 = "";
        var input2 = 100;
        input2 = 10;
        var click = document.getElementById('click');
        var num = document.getElementById('adadprog');
        num = 0;
        var adadgoal = document.getElementById('adadgoal');
        let reset = document.getElementById('reset');

        let background_2 = document.getElementById('background-2');

        const read_wrapper = document.getElementById('read-wrapper');
        const read_text_in_out = document.getElementById('read-text-in-out');

        background_intro.onclick = function () {
            document.getElementById('read').value = input1;
            num.value = input2;
            adadgoal.value = input2;
            intro.style.display = "none";
        }

        function normalizeEasternArabixDigits(s) {
            const eastern = '٠١٢٣٤٥٦٧٨٩';
            const western = '0123456789';
            let out = '';
            for (let ch of s) {
                const idx = eastern.indexOf(ch);
                out += (idx !== -1) ? western[idx] : ch;
            }
            return out;
        }

        click_start_intro.onclick = function () {
            intro_input_1_s = String(intro_input_1.value).trim();
            intro_input_2_s = String(intro_input_2.value).trim();

            let norm_1 = normalizeEasternArabixDigits(intro_input_1_s);
            let norm_2 = normalizeEasternArabixDigits(intro_input_2_s);

            const hasDigit_1 = /[0-9]/.test(norm_1);
            const hasAlpha_1 = /[A-Za-z\u0600-\u06FF]/.test(norm_1);
            const hasignore_1 = /[,.\/?\\{}\[\]:"'<>|!@#$%^&*()_\-+=~`]/.test(norm_1);

            const hasDigit_2 = /[0-9]/.test(norm_2);
            const hasAlpha_2 = /[A-Za-z\u0600-\u06FF]/.test(norm_2);
            const hasignore_2 = /[,.\/?\\{}\[\]:"'<>|!@#$%^&*()_\-+=~`]/.test(norm_2);

            if (intro_input_1_s === '' && intro_input_2_s === '') {
                intro_input_1.style.outline = '0.2rem solid red';
                intro_input_2.style.outline = '0.2rem solid red' ;

                document.querySelector('html').style.setProperty('--after-content-button', '"الحقول فارغة!؛ الرجاء ملؤها."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
                
                return;
            }

            else if ((!hasAlpha_1 && hasDigit_1 && !hasDigit_2 && hasAlpha_2) || (hasignore_1 & hasignore_2)) {
                intro_input_1.style.outline = '0.2rem solid red';
                intro_input_2.style.outline = '0.2rem solid red';

                document.querySelector('html').style.setProperty('--after-content-button', '"الرجاء إدخال الصيغ الصحيحة في الحقول."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
                
                
                return;
            }

            if (intro_input_1_s === '') {
                intro_input_1.style.outline = '0.2rem solid red';

                document.querySelector('html').style.setProperty('--after-content-button', '"الحقل الأول فارغ!؛ الرجاء ملؤه."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
            }
            
            else if ((!hasAlpha_1 && hasDigit_1) || hasDigit_1 || hasignore_1) {
                intro_input_1.style.outline = '0.2rem solid red';

                document.querySelector('html').style.setProperty('--after-content-button', '"الرجاء إدخال الصيغة الصحيحة في الحقل الأول."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
            }
            
            

            if (intro_input_2_s === '') {
                intro_input_2.style.outline = '0.2rem solid red';

                document.querySelector('html').style.setProperty('--after-content-button', '"الحقل الثاني فارغ!؛ الرجاء ملؤه."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
            }
            
            else if ((!hasDigit_2 && hasAlpha_2) || hasAlpha_2 || hasignore_2) {
                intro_input_2.style.outline = '0.2rem solid red';

                document.querySelector('html').style.setProperty('--after-content-button', '"الرجاء إدخال الصيغة الصحيحة في الحقل الثاني."');
                document.querySelector('html').style.setProperty('--opacity-before-after', '1');
                document.querySelector('html').classList.add('after-rise');
            }


            if (hasAlpha_1 && !hasDigit_1 && !hasignore_1) {
                document.getElementById('invalid-1').style.setProperty('--opacity-before-after', '0');
                intro_input_1.style.outline = 'none';
            }


            if (hasDigit_2 && !hasAlpha_2 && !hasignore_2) {
                document.getElementById('invalid-2').style.setProperty('--opacity-before-after', '0');
                intro_input_2.style.outline = 'none';
            }

            if (hasAlpha_1 && !hasDigit_1 && !hasignore_1 && hasDigit_2 && !hasAlpha_2 && !hasignore_2) {
                document.getElementById('invalid-1').style.setProperty('--opacity-before-after', '0');
                intro_input_1.style.outline = 'none';

                document.getElementById('invalid-2').style.setProperty('--opacity-before-after', '0');
                intro_input_2.style.outline = 'none';

                document.getElementById('read').textContent = intro_input_1.value;

                input2 = intro_input_2.value;
                num.value = intro_input_2.value;
                adadgoal.value = intro_input_2.value;

                intro.style.display = "none";
                return;
            }
            return;
        };

        background_2.onclick = function () {
            read_wrapper.scrollTo({ left: 0, behavior: 'smooth' });
            document.getElementById('container').classList.add('container-active');
            document.getElementById('body').classList.add('background-click-body-active');

            resetTimer = setTimeout(() => {
                document.getElementById('container').classList.remove('container-active');
            }, 450)

            if ((num + 1) < input2) {
                num++;
                document.getElementById("adadprog").value = num;
            }

            else {
                document.getElementById("adadprog").value = "تم!";
                document.getElementById("adadprog").style.fontSize = '2rem';
                document.getElementById('adadprog').classList.add('adadgoal');

                document.getElementById("body").style.backgroundColor = '#0b1f16';

                document.getElementById('reset').style.setProperty('--Main-Background-Color', '#0b1f16');

                document.getElementById('read').style.setProperty('--Main-Text-Shadow-Color', '#19c27f90');

                adadgoal.classList.add('adadgoal');

                document.getElementById('container').classList.add('adadgoalcon');

                document.getElementById('container').classList.add('container-active-done');

                resetTimer = setTimeout(() => {
                    document.getElementById('container').classList.remove('container-active-done');
                }, 450)

                document.getElementById("adadgoaldone").style.display = 'block';
            }
        };

        let reset_test = 0;
        let resetTimer;

        reset.onclick = function () {
            reset_test++;
            document.getElementById('reset').classList.add('reset-active');

            clearTimeout(resetTimer);

            if (reset_test === 2) {
                num = 0;
                document.getElementById("adadprog").value = "البداية!";
                document.getElementById("adadprog").style.fontSize = '5rem';
                document.getElementById("adadprog").classList.remove('adadgoal');

                adadgoal.classList.remove('adadgoal');

                read_wrapper.scrollTo({ left: 0, behavior: 'smooth' });

                document.getElementById("body").style.backgroundColor = 'rgb(24, 32, 40)';

                document.getElementById('container').classList.remove('adadgoalcon');

                document.getElementById("adadgoaldone").style.display = 'none';

                document.getElementById('read').style.setProperty('--Main-Text-Shadow-Color', '#1976c290');

                document.getElementById('reset').classList.add('reset-active-2');

                resetTimer = setTimeout(() => {
                    document.getElementById('reset').classList.remove('reset-active', 'reset-active-2');
                }, 100)
                
                document.getElementById('reset').style.setProperty('--Main-Background-Color', 'rgb(24, 32, 40)');
                
                setTimeout(() => {
                    document.getElementById('reset').classList.add('reset-after-active');

                    setTimeout(() => {
                        document.getElementById('reset').classList.remove('reset-after-active');
                    }, 1500);

                }, 500);
                
                
                reset_test = 0;
            }

            else {
                resetTimer = setTimeout(() => {
                    reset_test = 0;
                    document.getElementById('reset').classList.remove('reset-active');
                }, 1000)
            }
        };

        const read = document.getElementById('read');
        read.addEventListener('keydown', e => {
            if (e.key === 'Enter') e.preventDefault();
        });

        function updateFade() {
            const maxScroll = read_wrapper.scrollWidth - read_wrapper.clientWidth;
            const scrollLeft = Math.abs(read_wrapper.scrollLeft);

            if (scrollLeft <= 0) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '1');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '0');
            }

            else if (scrollLeft >= maxScroll - 1) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '0');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '1');
            }

            else {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '1');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '1');
            }

            if (read_wrapper.scrollWidth <= read_wrapper.clientWidth) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '0');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '0');
            }
        }

        read_wrapper.addEventListener('scroll', updateFade);
        read_wrapper.addEventListener('input', updateFade);

        const mo = new MutationObserver(() => {
            requestAnimationFrame(updateFade);
        });

        mo.observe(read_wrapper, { childList: true, subtree: true, characterData: true });

        window.addEventListener('load', updateFade);
    </script>
</body>

</html>
