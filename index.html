<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <link rel="stylesheet" href="./style.css">
    <link rel=" icon" href="./assets/imags/beads.png" type="image/png">
    <link rel="apple-touch-icon" href="./assets/imags/beads.png">
    <title>مِسبحةْ</title>
</head>

<body id="body">
    <div id="intro">
        <input type="text" id="intro-input-1" placeholder="أدخل عنوان الهدف!" autocomplete="off" autofocus />
        <ul id="suggestions" class="hidden"></ul>
        <input type="text" id="intro-input-2" maxlength="5" pattern="[0-9]{1,5}" placeholder="أدخل عدد التكرار!" />
        <div></div>
        <ul id="suggestions-2" class="hidden"></ul>
        <button type="submit" id="click-start-intro">أبدأ</button>
        <div id="background-intro"></div>
    </div>

    <input type="text" id="adadprog" value="البداية!" disabled>
    <input type="text" id="adadgoal" value="الهدف!" disabled>
    <div class="container" id="container">
        <div class="read-wrapper" id="read-wrapper" aria-hidden="true">
            <div id="read" class="read-text" contenteditable="true"></div>
        </div>
        <div class="read-text-in-out" id="read-text-in-out"></div>
        <div id="adadgoaldone"></div>
    </div>
    <button id="reset" tabindex="0"><img src="./assets/imags/agin.png" alt="Reset"></button>
    <div id="background-2" class="background-click" tabindex="0"></div>
    <script>
        let intro = document.getElementById('intro');
        let background_intro = document.getElementById('background-intro');
        let intro_input_1 = document.getElementById('intro-input-1');
        let intro_input_2 = document.getElementById('intro-input-2');
        let click_start_intro = document.getElementById('click-start-intro');

        var input1 = "";
        var input2 = 100;
        var click = document.getElementById('click');
        var num = document.getElementById('adadprog');
        num = 0;
        var adadgoal = document.getElementById('adadgoal');
        let reset = document.getElementById('reset');

        let background_2 = document.getElementById('background-2');

        const read_wrapper = document.getElementById('read-wrapper');
        const read_text_in_out = document.getElementById('read-text-in-out');

        background_intro.onclick = function () {
            document.getElementById('read').value = input1;
            num.value = input2;
            adadgoal.value = input2;
            intro.style.display = "none";
        }

        function normalizeEasternArabixDigits(s) {
            const eastern = '٠١٢٣٤٥٦٧٨٩';
            const western = '0123456789';
            let out = '';
            for (let ch of s) {
                const idx = eastern.indexOf(ch);
                out += (idx !== -1) ? western[idx] : ch;
            }
            return out;
        }

        intro_input_1.addEventListener('input', () => {
            intro_input_1.classList.remove('intro-intro-inputs-invalid');
        });

        const options = ["سبحان الله", "الحمدلله", "الله أكبر", "لا إله إلا الله", "سبحان الله وبحمده", "لاحول ولا قوة إلا بالله", "اللهم صل وسلم على نبينا محمد"];
        const list = document.getElementById("suggestions");

        intro_input_1.addEventListener("input", () => {
            const value = intro_input_1.value.toLowerCase();
            list.innerHTML = "";

            if (!value) {
                list.classList.add("hidden");
                return;
            }

            const matches = options.filter(option => option.toLowerCase().includes(value));

            if (matches.length === 0) {
                list.classList.add("hidden");
                return;
            }

            matches.forEach(option => {
                const li = document.createElement("li");
                li.textContent = option;
                li.addEventListener("click", () => {
                    intro_input_1.value = option;
                    list.classList.add("hidden");
                });
                list.appendChild(li);
            });

            list.classList.remove("hidden");
        });

        document.addEventListener("click", e => {
            if (!list.contains(e.target) && e.target !== intro_input_1) {
                list.classList.add("hidden");
            }
        });

        const options_2 = ["10", "33", "70", "100", "250", "500", "1000"];
        const list_2 = document.getElementById("suggestions-2");

        intro_input_2.addEventListener("input", () => {
            const value_2 = intro_input_2.value.toLowerCase();
            list_2.innerHTML = "";

            if (!value_2) {
                list_2.classList.add("hidden");
                return;
            }

            const matches_2 = options_2.filter(option_2 => option_2.toLowerCase().includes(value_2));

            if (matches_2.length === 0) {
                list_2.classList.add("hidden");
                return;
            }

            matches_2.forEach(option_2 => {
                const li_2 = document.createElement("li");
                li_2.textContent = option_2;
                li_2.addEventListener("click", () => {
                    intro_input_2.value = option_2;
                    list_2.classList.add("hidden");
                });
                list_2.appendChild(li_2);
            });

            list_2.classList.remove("hidden");
        });

        document.addEventListener("click", e_2 => {
            if (!list_2.contains(e_2.target) && e_2.target !== intro_input_2) {
                list_2.classList.add("hidden");
            }
        });

        intro_input_2.addEventListener('input', () => {
            intro_input_2.classList.remove('intro-intro-inputs-invalid');
        });

        click_start_intro.onclick = function () {
            intro_input_1_s = String(intro_input_1.value).trim();
            intro_input_2_s = String(intro_input_2.value).trim();

            let norm_2 = normalizeEasternArabixDigits(intro_input_2_s);

            const hasDigit_2 = /[0-9]/.test(norm_2);
            const hasAlpha_2 = /[A-Za-z\u0600-\u06FF]/.test(norm_2);
            const hasignore_2 = /[,.\/?\\{}\[\]:"'<>|!@#$%^&*()_\-+=~`]/.test(norm_2);

            if (intro_input_1_s === '' && intro_input_2_s === '') {
                intro_input_1.classList.add('intro-intro-inputs-invalid');
                intro_input_2.classList.add('intro-intro-inputs-invalid');


                document.querySelector('html').style.setProperty('--after-content-click-start', '"الحقول فارغة!؛ الرجاء ملؤها."');

                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-after', '1');
                    document.querySelector('html').style.setProperty('--after-content-click-start-translate', 'translateY(0)');
                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-after');
                        document.querySelector('html').style.removeProperty('--after-content-click-start-translate');
                    }, 3000)
                }, 200)

                return;
            }

            else if (intro_input_1_s === '' && ((!hasDigit_2 && hasAlpha_2) || hasAlpha_2 || hasignore_2)) {
                intro_input_1.classList.add('intro-intro-inputs-invalid');
                intro_input_2.classList.add('intro-intro-inputs-invalid');

                document.querySelector('html').style.setProperty('--after-content-click-start', '"الحقل الأول فارغ!؛ الرجاء ملؤه."');

                document.querySelector('html').style.setProperty('--before-content-click-start', '"الرجاء إدخال الصيغة الصحيحة في الحقل الثاني."');
                document.querySelector('html').style.setProperty('--fs-before-syn', '1.3rem');

                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-after', '1');
                    document.querySelector('html').style.setProperty('--after-content-click-start-translate', 'translateY(-105%)');
                    document.querySelector('html').style.setProperty('--opacity-click-start-before', '1');
                    document.querySelector('html').style.setProperty('--before-content-click-start-translate', 'translateY(0)');

                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-after');
                        document.querySelector('html').style.removeProperty('--after-content-click-start-translate');
                        document.querySelector('html').style.removeProperty('--opacity-click-start-before');
                        document.querySelector('html').style.removeProperty('--before-content-click-start-translate');
                    }, 3000)

                }, 200)
            }

            else if (intro_input_1_s === '' && hasDigit_2 && !hasAlpha_2 && !hasignore_2) {
                intro_input_1.classList.add('intro-intro-inputs-invalid');
                intro_input_2.classList.remove('intro-intro-inputs-invalid');

                document.querySelector('html').style.setProperty('--after-content-click-start', '"الحقل الأول فارغ!؛ الرجاء ملؤه."');

                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-after', '1');
                    document.querySelector('html').style.setProperty('--after-content-click-start-translate', 'translateY(0)');

                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-after');
                        document.querySelector('html').style.removeProperty('--after-content-click-start-translate');
                    }, 3000)

                }, 200)
            }

            else if (intro_input_1_s !== '' && intro_input_2_s === '') {
                intro_input_1.classList.remove('intro-intro-inputs-invalid');
                intro_input_2.classList.add('intro-intro-inputs-invalid');

                document.querySelector('html').style.setProperty('--before-content-click-start', '"الحقل الثاني فارغ!؛ الرجاء ملؤه."');
                document.querySelector('html').style.setProperty('--fs-before-syn', '1.3rem');

                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-before', '1');
                    document.querySelector('html').style.setProperty('--before-content-click-start-translate', 'translateY(0)');

                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-before');
                        document.querySelector('html').style.removeProperty('--before-content-click-start-translate');
                    }, 3000)

                }, 200)
            }

            else if (intro_input_1_s !== '' && ((!hasDigit_2 && hasAlpha_2) || hasAlpha_2 || hasignore_2)) {
                intro_input_1.classList.remove('intro-intro-inputs-invalid');
                intro_input_2.classList.add('intro-intro-inputs-invalid');

                document.querySelector('html').style.setProperty('--before-content-click-start', '"الرجاء إدخال الصيغة الصحيحة في الحقل الثاني."');
                document.querySelector('html').style.setProperty('--fs-before-syn', '1.3rem');

                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-before', '1');
                    document.querySelector('html').style.setProperty('--before-content-click-start-translate', 'translateY(0)');

                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-before');
                        document.querySelector('html').style.removeProperty('--before-content-click-start-translate');
                    }, 3000)

                }, 200)
            }

            else if (intro_input_1_s !== '' && hasDigit_2 && !hasAlpha_2 && !hasignore_2) {
                intro_input_1.classList.remove('intro-intro-inputs-invalid');
                intro_input_2.classList.remove('intro-intro-inputs-invalid');

                document.querySelector('html').style.setProperty('--before-content-click-start', '"تم بنجاح."')
                document.querySelector('html').style.setProperty('--Invalid-background-color', '#051b11');
                document.querySelector('html').style.setProperty('--Invalid-text-color', '#75b798');
                document.querySelector('html').style.setProperty('--Invalid-border-color', '#0f5132');
                
                setTimeout(() => {
                    document.querySelector('html').style.setProperty('--opacity-click-start-before', '1');
                    document.querySelector('html').style.setProperty('--before-content-click-start-translate', 'translateY(0)');
                    
                    setTimeout(() => {
                        document.querySelector('html').style.removeProperty('--opacity-click-start-before');
                        document.querySelector('html').style.removeProperty('--before-content-click-start-translate');
                    }, 2000)
                    
                }, 200)
                
                setTimeout(() => {
                    document.querySelector('html').style.removeProperty('--Invalid-background-color');
                    document.querySelector('html').style.removeProperty('--Invalid-text-color');
                    document.querySelector('html').style.removeProperty('--Invalid-border-color');
                }, 3000)

                document.getElementById('read').textContent = intro_input_1.value;

                input2 = intro_input_2.value;
                num.value = intro_input_2.value;
                adadgoal.value = intro_input_2.value;

                intro.style.display = "none";

                return;
            }
            return;
        };

        background_2.onclick = function () {
            read_wrapper.scrollTo({ left: 0, behavior: 'smooth' });
            document.getElementById('container').classList.add('container-active');
            document.getElementById('body').classList.add('background-click-body-active');
            document.getElementById("adadprog").style.fontSize = '2.5rem';
            adadgoal.style.fontSize = '2.5rem';
            
            resetTimer = setTimeout(() => {
                document.getElementById('container').classList.remove('container-active');
            }, 450)

            if ((num + 1) < input2) {
                num++;
                document.getElementById("adadprog").value = num;
            }
            
            else {
                document.getElementById("adadprog").style.fontSize = '1.9rem';
                adadgoal.style.fontSize = '1.9rem';
                document.getElementById("adadprog").value = "تم!";
                document.getElementById('adadprog').classList.add('adadgoal');

                document.getElementById("body").style.backgroundColor = '#0b1f16';

                document.getElementById('reset').style.setProperty('--Main-Background-Color', '#0b1f16');

                document.getElementById('read').style.setProperty('--Main-Text-Shadow-Color', '#19c27f90');

                adadgoal.classList.add('adadgoal');

                document.getElementById('container').classList.add('adadgoalcon');

                document.getElementById('container').classList.add('container-active-done');

                resetTimer = setTimeout(() => {
                    document.getElementById('container').classList.remove('container-active-done');
                }, 450)

                document.getElementById("adadgoaldone").style.display = 'block';
            }
        };

        let reset_test = 0;
        let resetTimer;

        reset.onclick = function () {
            reset_test++;
            clearTimeout(resetTimer);
            document.getElementById('reset').classList.add('reset-active');

            if (reset_test === 2) {
                num = 0;
                document.getElementById("adadprog").value = "البداية!";
                document.getElementById("adadprog").classList.remove('adadgoal');

                adadgoal.classList.remove('adadgoal');

                read_wrapper.scrollTo({ left: 0, behavior: 'smooth' });

                document.getElementById("body").style.backgroundColor = 'rgb(24, 32, 40)';

                document.getElementById('container').classList.remove('adadgoalcon');

                document.getElementById("adadgoaldone").style.display = 'none';

                document.getElementById('read').style.setProperty('--Main-Text-Shadow-Color', '#1976c290');

                document.getElementById('reset').classList.remove('reset-active');

                document.getElementById('reset').classList.add('reset-active-2');

                resetTimer = setTimeout(() => {
                    document.getElementById('reset').classList.remove('reset-active', 'reset-active-2');
                }, 150)

                document.getElementById('reset').style.setProperty('--Main-Background-Color', 'rgb(24, 32, 40)');

                reset_test = 0;

                setTimeout(() => {
                    document.getElementById('reset').classList.add('reset-after-active');
        
                    setTimeout(() => {
                        document.getElementById('reset').classList.remove('reset-after-active');
                    }, 1600);
        
                }, 250);
            }

            else {
                resetTimer = setTimeout(() => {
                    reset_test = 0;
                    document.getElementById('reset').classList.remove('reset-active');
                }, 1200)
            }
        };

        const read = document.getElementById('read');
        read.addEventListener('keydown', e => {
            if (e.key === 'Enter') e.preventDefault();
        });

        function updateFade() {
            const maxScroll = read_wrapper.scrollWidth - read_wrapper.clientWidth;
            const scrollLeft = Math.abs(read_wrapper.scrollLeft);

            if (scrollLeft <= 0) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '1');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '0');
            }

            else if (scrollLeft >= maxScroll - 1) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '0');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '1');
            }

            else {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '1');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '1');
            }

            if (read_wrapper.scrollWidth <= read_wrapper.clientWidth) {
                read_text_in_out.style.setProperty('--read-text-in-out-before', '0');
                read_text_in_out.style.setProperty('--read-text-in-out-after', '0');
            }
        }

        read_wrapper.addEventListener('scroll', updateFade);
        read_wrapper.addEventListener('input', updateFade);

        const mo = new MutationObserver(() => {
            requestAnimationFrame(updateFade);
        });

        mo.observe(read_wrapper, { childList: true, subtree: true, characterData: true });

        window.addEventListener('load', updateFade);
    </script>
</body>

</html>
